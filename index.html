<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rival AI - Beta</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="theme-white font-inter">

    <div id="sidebar" class="sidebar">
        <h3>Riwayat Chat</h3>
        <div id="chat-history-list"></div>
    </div>

    <main>
        <nav>
            <button onclick="toggleSidebar()">â˜°</button>
            <div class="logo">RIVAL <span class="badge">BETA</span></div>
            <button onclick="newChat()">+</button>
        </nav>

        <div id="status" style="font-size: 10px; text-align: center; color: gray;">
            Menyiapkan Otak Rival... (Hanya pertama kali)
        </div>

        <div id="chat-container"></div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="Tanya Rival (Offline)...">
            <button id="sendBtn" onclick="generateResponse()">Kirim</button>
        </div>
    </main>

    <script type="module">
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

        let pipe;
        const status = document.getElementById('status');
        const chatContainer = document.getElementById('chat-container');

        // 1. Load Model (Pake model paling enteng biar kenceng)
        async function initAI() {
            try {
                status.innerText = "Lagi mikir sebentar (Loading Model)...";
                pipe = await pipeline('text-generation', 'Xenova/TinyLlama-1.1B-Chat-v1.0');
                status.innerText = "Rival Siap! (100% Offline)";
            } catch (e) {
                status.innerText = "Gagal load otak AI. Cek koneksi awal.";
            }
        }
        initAI();

        // 2. Fungsi Generate Jawaban
        window.generateResponse = async () => {
            const input = document.getElementById('userInput').value;
            if (!input || !pipe) return;

            // Tampilkan Chat User
            appendChat('User', input);
            document.getElementById('userInput').value = '';

            // Proses AI
            status.innerText = "Rival lagi ngetik...";
            const output = await pipe(input, {
                max_new_tokens: 50,
                temperature: 0.7,
                repetition_penalty: 1.2,
            });

            const aiReply = output[0].generated_text.replace(input, "").trim();
            appendChat('Rival', aiReply);
            status.innerText = "Online (Offline Mode)";
        };

        function appendChat(role, text) {
            const div = document.createElement('div');
            div.className = role === 'User' ? 'user-msg' : 'ai-msg';
            div.innerHTML = `<b>${role}:</b> <p>${text}</p>`;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    </script>
</body>
</html>
